<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåç Weather Trend Forecasting</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); min-height: 100vh; color: #fff; }
        .container { max-width: 900px; margin: 0 auto; padding: 2rem; }
        h1 { text-align: center; font-size: 2.5rem; margin-bottom: 2rem; background: linear-gradient(90deg, #4facfe, #00f2fe); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .card { background: rgba(255,255,255,0.05); border-radius: 16px; padding: 2rem; margin-bottom: 1.5rem; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .form-row { display: flex; gap: 1rem; flex-wrap: wrap; }
        .form-group { flex: 1; min-width: 200px; }
        label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: #4facfe; }
        select, input { width: 100%; padding: 0.75rem 1rem; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.1); color: #fff; font-size: 1rem; }
        select option { background: #1a1a2e; }
        button { width: 100%; padding: 1rem; background: linear-gradient(90deg, #4facfe, #00f2fe); border: none; border-radius: 8px; color: #1a1a2e; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
        button:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(79,172,254,0.3); }
        button:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        #chart { height: 350px; border-radius: 12px; overflow: hidden; }
        .summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 1rem; margin-top: 1.5rem; }
        .stat { text-align: center; padding: 1rem; background: rgba(79,172,254,0.1); border-radius: 12px; }
        .stat-value { font-size: 1.5rem; font-weight: 700; color: #4facfe; }
        .stat-label { font-size: 0.8rem; color: rgba(255,255,255,0.7); margin-top: 0.25rem; }
        .stat.success { background: rgba(0,200,100,0.15); }
        .stat.success .stat-value { color: #00c864; }
        table { width: 100%; border-collapse: collapse; margin-top: 1.5rem; }
        th, td { padding: 0.75rem; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1); }
        th { color: #4facfe; font-weight: 500; }
        .actual { color: #00c864; }
        .error { color: #ff6b6b; font-size: 0.85rem; }
        .hidden { display: none; }
        .badge { display: inline-block; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem; margin-left: 0.5rem; }
        .badge-success { background: rgba(0,200,100,0.2); color: #00c864; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåç Weather Trend Forecasting</h1>
        
        <div class="card">
            <div class="form-row">
                <div class="form-group">
                    <label for="country">Country</label>
                    <select id="country"><option>Loading...</option></select>
                </div>
                <div class="form-group">
                    <label for="date">Start Date</label>
                    <input type="date" id="date">
                </div>
            </div>
            <button id="btn" style="margin-top: 1rem;">üîç Get 7-Day Forecast</button>
        </div>
        
        <div id="results" class="hidden">
            <div class="card">
                <div id="chart"></div>
                <div class="summary" id="summary"></div>
            </div>
            <div class="card">
                <h3 style="margin-bottom: 1rem; color: #4facfe;">üìÖ Daily Breakdown</h3>
                <table>
                    <thead><tr><th>Date</th><th>Day</th><th>Predicted</th><th>Actual</th><th>Error</th></tr></thead>
                    <tbody id="table"></tbody>
                </table>
            </div>
        </div>
    </div>
    
    <div style="text-align: center; margin-top: 3rem; opacity: 0.6; font-size: 0.8rem; padding-bottom: 2rem; max-width: 900px; margin-left: auto; margin-right: auto;">
        <p><strong>PM Accelerator Mission</strong>: "By making industry-leading tools and education available to individuals from all backgrounds, we level the playing field for future PM leaders. This is the PM Accelerator motto, as we grant aspiring and experienced PMs what they need most ‚Äì Access. We introduce you to industry leaders, surround you with the right PM ecosystem, and discover the new world of AI product management skills."</p>
    </div>
    
    <script>
        const $ = id => document.getElementById(id);
        const API = '';
        
        (async () => {
            const res = await fetch(`${API}/api/countries`);
            const {countries} = await res.json();
            $('country').innerHTML = countries.map(c => `<option>${c}</option>`).join('');
            $('date').value = new Date().toISOString().split('T')[0];
        })();
        
        $('btn').onclick = async () => {
            $('btn').disabled = true;
            $('btn').textContent = '‚è≥ Loading...';
            
            try {
                const res = await fetch(`${API}/api/forecast`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({country: $('country').value, start_date: $('date').value})
                });
                const data = await res.json();
                if (!res.ok) throw new Error(data.detail);
                
                // Chart with both predicted and actual
                const traces = [{
                    x: data.forecast.map(f => f.date),
                    y: data.forecast.map(f => f.temp),
                    type: 'scatter', mode: 'lines+markers', name: 'Predicted',
                    line: {color: '#4facfe', width: 3}, marker: {size: 10}
                }];
                
                // Add actual line if available
                const hasActual = data.forecast.some(f => f.actual !== null);
                if (hasActual) {
                    traces.push({
                        x: data.forecast.filter(f => f.actual !== null).map(f => f.date),
                        y: data.forecast.filter(f => f.actual !== null).map(f => f.actual),
                        type: 'scatter', mode: 'lines+markers', name: 'Actual',
                        line: {color: '#00c864', width: 3}, marker: {size: 10}
                    });
                }
                
                Plotly.newPlot('chart', traces, {
                    paper_bgcolor: 'transparent', plot_bgcolor: 'transparent', font: {color: '#fff'},
                    xaxis: {gridcolor: 'rgba(255,255,255,0.1)'},
                    yaxis: {gridcolor: 'rgba(255,255,255,0.1)', title: 'Temperature (¬∞C)'},
                    margin: {t: 20, r: 20, b: 40, l: 50}, legend: {x: 0, y: 1.1, orientation: 'h'}
                }, {responsive: true});
                
                // Summary
                const s = data.summary;
                let summaryHtml = `
                    <div class="stat"><div class="stat-value">${s.min}¬∞</div><div class="stat-label">Min</div></div>
                    <div class="stat"><div class="stat-value">${s.max}¬∞</div><div class="stat-label">Max</div></div>
                    <div class="stat"><div class="stat-value">${s.avg}¬∞</div><div class="stat-label">Average</div></div>
                    <div class="stat"><div class="stat-value">${s.trend}</div><div class="stat-label">Trend</div></div>
                `;
                if (s.has_actual) {
                    summaryHtml += `<div class="stat success"><div class="stat-value">${s.mae}¬∞</div><div class="stat-label">MAE (${s.actual_days} days)</div></div>`;
                }
                $('summary').innerHTML = summaryHtml;
                
                // Table
                $('table').innerHTML = data.forecast.map(f => {
                    const actualCell = f.actual !== null ? `<td class="actual">${f.actual}¬∞C</td>` : '<td>-</td>';
                    const errorCell = f.actual !== null ? `<td class="error">${Math.abs(f.temp - f.actual).toFixed(1)}¬∞</td>` : '<td>-</td>';
                    return `<tr><td>${f.date}</td><td>${f.day}</td><td><strong>${f.temp}¬∞C</strong></td>${actualCell}${errorCell}</tr>`;
                }).join('');
                
                $('results').classList.remove('hidden');
            } catch (e) {
                alert('Error: ' + e.message);
            }
            
            $('btn').disabled = false;
            $('btn').textContent = 'üîç Get 7-Day Forecast';
        };
    </script>
</body>
</html>
